definitions:
  build_config: &build_config
     instance_type: mac_mini
     max_build_duration: 60

  developer_credentials: &developer_credentials
    APPLE_ID: Encrypted(Z0FBQUFBQmd3TGZUSDVTOFR5LWRITjJBTm9TbDUwbGdJdGpyN09jdWNFZjVPUGp0SVU2NUJIQTN0LUhNYndGVnhHdk41TTl1aXljT3dOc1ZSTlVobnVFeG9ZN3dIMEEyR2d6Y1VwZnBvWFdGS3hQY0xNWXFDMGs9)
    APPLE_APP_SPECIFIC_PASSWORD: Encrypted(Z0FBQUFBQmd3TG13dm9vWURQcXNMRjgtVGs4UTNSU1h4dXN1cmRTSy1wX3lCRV9aay1sRkthNHZHV1kxZU1iYzRNT1lpS05DWFZMeC1XemxrVzZrZU1IdHdHVGhxSE1Gc3lLY2M0cy1BYVREVG5fZDh1TkdrXzA9)

  apple_signing: &apple_signing
    APP_STORE_CONNECT_ISSUER_ID: Encrypted(Z0FBQUFBQmd4eWVwYnhMeGpheEJMeGJURTRqbFo0TGVucVlnX0VOd1BGY19HNE8xelRZNHNENVg2TEVpYUlpLU95bXRodTBqVFNtcHV3ZkpMcHlNcEZVZ1g2UUFaU3I1S1ExYjRpcERkVXFObkFqb0VLT0FpMW52YU1JRjNpYlRRUlRFUjY4WU44cUQ=)
    APP_STORE_CONNECT_KEY_IDENTIFIER: Encrypted(Z0FBQUFBQmd4eWZPenZMVUFQOWhkV1pHUE1jR2lGd29fNGlpeXpGalRBNzR6M0xraDVRczB1cmhMUG15dkZDWEF2SGtXd2RQSWZ5eURLSXNjdlIxTUc1T0pNTFlBam81UGc9PQ==)
    APP_STORE_CONNECT_PRIVATE_KEY: Encrypted(Z0FBQUFBQmd4eWQ1bHJpOXR5SFdhRk1DdzJ4aFVXU3dGRHF4WGtrOHZzZGFBSFlwaTF4TWRsTWlEenlFMjdyRGRfR3hEbWZJdzlsNFF0dUpzeTU5eTFQSk51dEVTTzhQUndadHFoemhvTll0eDVfdVpsbV9IY0wwVGx1REZCNDljdkJacnRxcEhCQy1QaE4zQjVaREg1a2VMQTB2Q2s4SWQ2bTRPTWYzeW1KYVRTY0RnVTFzbnNmWVhoTkZnWkt6cHM3aWlTUk5TS0JmTTlYZFM3YTZEU3ZaUk1ydnBYZENlMmhKSWtYRTNlOEl5dnVDQWF0SHZJa3BHWmlaT2hNa3hTeXgxYW8yNkZiT1NYTUs4c2tjZjZnY1NTeHRaR1A0RmxOZXJpb2Fkbzd6UmVlXzZ3X2pRc2dwaU95emxNX2VrTm1QMDBxWFpRazMtVnNjVUlwN1hBZF9LU0dCWHh6RUxOeU01T3ljbnFvQlk2OXYyRGdrMUYwRVhVcmhUSU8wQ2l6bzR4Q2ZJbEt0TkpaSTQwRVlaQjNMWXVwRkVfTmstNllYcFlfandwUWtRTmRmUlBSVGI2az0=)
    CERTIFICATE_PRIVATE_KEY: Encrypted(Z0FBQUFBQmd3Tld4aFFYUzJrb3B4RDNoQk45ZVNnSndaSHpQYTVrZ1B3cTctN3Rkc0F3d01wYVZhMGhxOU1mZ2NOY0ZMTV9FOTF6Y2JsUVhWdWRqdGxsc2JsS25IUlphTVFBejdFcl82UDVRUG50TGNDT1BKdTdyZUhWeXhma3V2RnpseWktQ3RuYTN0VHNIOUhEc2Z4YkxhTWFWRERWVTFHM0RlN3RhZmlEWkhNMVdrNndQdC1mbG1QUTNVcFBjYXhWRlQzTi03aS1jTm4wQW5BQ1VuUXNKcmQ4dzdWZjNjb05jY0FrcG0zbm1WVGliaEhHbmQtQWtYVEhZdnVxamtpLVhzZHExYkhBa2NBQUJmNTVkR2RtREFhZXpEX1BicDB0WXp6cVprWWlEVl9pWENIODZWcmJ5bkkyVldvdS1pR1B3UDBSMVpvSy1lZ3ZCclRBVUNBOWJwTHVuR3hmSUwzU1FHSTc2S2M2VWVFdTl3SGl6RFJYNXFfc1dudlJkNkRqdVowUmd1dXFUVVpSckYzdUVaX2EzdFdQS2k5dUg4MkRVUVNTR3B4OHVjM1Q0d195QlpkM0xuQ2hHSzFFQk8wZWRCRDZOek1zSHhRZVRSdkZERGFFTXl4VGpSZnFSTi03c19rVnJBSDFGMDl2WkdKRTRxRFhsZ0VmZXVGMl9pTlJPQmRjYmJJYXFzdk1VX21MMzhPUUhRV0t4MXZtbHp2cnhSOUlXTmhRRG9meFNnWnBWUlg1d0tOMkVqTXRvNEIwUTFJY0FmdFpLZWNLUTlLeXNwMmZJQXhJd011RnpBTUpGSmdLTHY1Y29kOHdtLXZzd2R3TU9NWi1iUXJUelB6c3NxS2Z6XzEtVS0xZ1p3ZHlacVNDT19SUnpZYlBXVHdEaWR5VVB4UnZ0SVhtNGFpS0pfdE5UYjhmTzNsd2ZLMFJsWndFQ25GTWE4MlpQS2R1SHdiSFdlcXFUT2Q1UktydFpUY0JVVnFoYUZIU1BxTFNCc3BPQWYyZ2ViMXZ6MTlzcXNVTW1WSURrNXNmSnBUeVpsdlZOcWVfdWlPUG94emk1OHJYWDVpMzVYSW5uVF9RNVl1YVZqSWdaSFdoSC1XNG96a0RSUExKcjhuTXo1eVlwd1Y4aG9RNXd4OE9wYUdXMlVnS0U5Q3g1MjVHZHBVZnRmMWVLOEJrbzVKYjBRUW5MbGtFT0VGVlptemNfWmRwNU4wbTkxT1NndWtuaHVGNmpCOHdBeUhHbG9GMXE4RUM1dW9NUGxiYjFYUGk3UnY1aTZGa3F1ZE9iRHV0eHBmTVVEbkJleFdpcDMxZWU0OU5yUE9wX0lrTnlUWktGOUNqeDBqZmdpSm5Va3hfekR5XzFQZ01SMGQ3djcyN1AzakFWMGlZYzJZcjcwV1k4XzFobTRRUTM2MnhkRDhYTTZ1TXM5b1J1eGZPZkZvSWc2cnNFS1JPNy0teTM1azZqQ2dzOXlMa3pWcm5udy1uNy05NkpHOWZqMWU2cUxlOEh2blQ3bktRMnNHOHlGakFYVy12dEpHNWJzbDRxSElLVTdGQ1JjYXdFaFVUanE0RnNpaThhVmtVMTRSbjF3RmhEMEJKY1hQc2VFRXRNVG5wREJ3T3RfQm5lYV95bDNUYUt5Z21sX19NVzcxNFFOS2xrNFp6a1VJbW1PVVlIWUhmTmlDeHZ4cklDMnpYUHMtT0lKV181Wmd2S08zN1JhQmJCUnR3M19wR3BvWVowM2ZLS0xTM3dFU1JqYUVvOG1wclZNUy1ROTlpOWNDZTlISVVMVUp0ZFkxUFRoNENkenlXLUZKVF9VXy15UHZNTXF2ZlBJSkdDdUtyanloNGQ2eHFEMHBGSkJxb3YxdjlXSDZsd29iaHQ0dl9CWnRDcGVyVkZGTS1xRTlJemlqbTJUd3ZCbkE4eGdrS3k4UEZTWkx5eVJCSzU0Q1RMQXFTMlJ3d1Vpb3RHcnhOWlp1VmNaTTZPODFGb0Z5LXpNa3BwWnFuQl9YcUlkTllnb2RIQkNmX0xMMTd2NjgwRVY2QWVvVE9JQnF0S1ZaUGhOZ2FNZ19XSnZYZHBhWFJLLTJKWmtNUVNqVEw0WEhfNTJ1cmk3VXgxZmNpRU9XazJVYmY2MW1oSUx4QVVNTmFEWngwNVdtLWROMEVHRU1CcXZaS2JDczNJY3pLcXVZTGJLRjlzeW9QZkdBdVdzX2ZsWExCRndEdEtXRW5fVi1tV1dxbFhlYTBpcmZRN1Y4dXl1M3VsakFRc3ktSXhyMFNCODFWZkNUeGI1NmVjOFhnSXdITUlLRTZ3NndVS1duWW5uZVpfWTRITFZHeW5na0Y1UDlCVGNRQ1VkR2RTRWw4NF81NklTVmVXYjhYMzcwTDhCeVBpVUhONXNybjloUXBFRW11U3J0dnBUbmFhOS1Nanlrd0NCSGlJUVNnVEVzNEs1WVNaWDI4YVBDSWY0R2h6V0UwMUJhakc5WTlHRnh5Z25ScmcxeTBlOFNuR1pWOHdGM01QNHRvRG9CODZMQmlRQkVzVXZLNlNXcXd5Y2gxUEdNNXA3VkVKV0w0TlpOaDU4QUhLQVlVdDhVaEFWdFRGS0MtVzQydGljQ0FUbjYxSlZqMkVpN2xRRm5FeVhPTFpVQS1LV0NjODdFdWxob25nN3dEcUJWYVZSd0JOM1VReHc4RVUtQ2tsdXlkMEQ4VV9vN2pXc3ZUTkdfaHE4enpJeHdaYmhmbHpCYXBHNmFMT21PdmJZY3VDSldsbG9EWFFqcTg5dWd6XzB4SC0za2NadUhMWkJTdDBpV3ZaVjFHaXBHejE2LWdQNWdSdHNZSkdSdk9rOENiakZGN0FORkl1SUJ1X2FFVm4yZUFibjMyWGs2bW1VcmVPRkk3dkJ6MGhKLVYwU1RzR0dmd1l5MENZUEVQNE91MVd4RkNTcndmbFhDdlEzTk5TOXZTOEJkSWV5Y056ZlVGeDJEdXExcE9wajUzQWZHU001eFlqbmIxaElUNnhjWUt2TTByaGw2dGN4S1ZlM0hTVlhfb3c0SmM4ZWZfeTB6OTBaVmVXclYwYXpKbXR3bThWS0VzX1E3VERtWmVu)

  new_app_trading: &new_app_trading_config
    BUNDLE_ID: "newapp.trading"
    APP_STORE_ID: 1571283112
    GOOGLE_SERVICE_IOS: Encrypted(Z0FBQUFBQmd5SzBGY0NXdUJDWldmYUNGTF9pX2NxZnpVcVU5dm1tSDJldy1YN0dHUmJnQVRIZmREMms5akJ1SFB5eUdtS09icGRXUVRSZjMyYlJlSHFlSldpRzF5WWRzN2NHUUZzTWxBVnlJNlB0bWlRbEVQclU1SVFTeUNrNC1rcFNoejU0b0Jra3RMOUgzRzJRMmxtOUh4NnlScWxaZmtLSmxXZ1dtcUU4R2FybllHVVRBcEZQU2RLYXNXWTQzWnFwaXpTc3F6dmNiY2lvZnlyZWoyUWJxQnJaSlloaEtVZkpCNUZ2bmFDd1dWSVNEYUt2RWg0Vld4eE9YcjFWNFZubFZ6eG9ySl9hd3AySzNDOWxoZXdrd2lXLXozOHBRd3dVM3E0Sm9tOW81ZG1VUHNyaU5FWTdzWTByQUdzcDBQVTJvTFhWQ2pGcWtUeklSZlVwU09TRi1SN3dqX1F0WEZkelJDeDR0SVNkLW9nY0YxMHkxaUVDTmRoZnhTOHA2REhESEVSOFlXWWE0WXVZbi13VlVrNUlsMzJPZWdJY2lOQXdPdGpkRWpnZDZrZ0dwMEFvZUtyU3dLc1RRTTVGTnd0WW1JNWlfNmhxYjR4aUhmQU9Fd2RjLTRRU0EwSW11YmE0TXZGVnZoMGVJaUY3aDZwVkdRaWVLMkJ5SmRpUjc5VkxKcmdnbVE0Q1ZONFBGS0VBVFc3a2lPMnFoLVN1MUpmVVVQOU1kLWZUdDRsT2p1WGs4VEpTVkxKQkphTTZJNExKbG1hSTFGOVh6MUNPZHpKUUFWUFZzVllrRnMyZVNUT2NiOW52RldmMmRIT0xicURMVmVYSDhZVzhlcF8wNklQeDB6VWpmZHdYeVdVWXk1bFgxT3hXMGQ2Sk5jeVlENzk2UGlUU08yMW9YUUN1cnFabnppNWh1RXBmOE5LaFRvaWd3LUo4MDlGUERjd0daOEUzd2p0TURuQWg4UTRxa3JEbkx1WHhSZlZkcTd0WWd6ZHA4c2REVTFCY19yTzV5OHdEUlRobzlTNnhxall6em5ib0Uyamg3VFRQNTFrTnRHdE45MG4zSlFuaERNU3p4UW9kbGk0T2NTUm9UZzJnT004VnM0VWtvMFBzdjgweW4xSGJjWW1MNmNDT0FyVDdzMzdyRjFUTnk5b3dYdEdCR0lBNXVtakxtaF9JYkdUdUdSNzZYdEFycG1IM2N5eHVEWldlcTVtaW5uUjBFYWJQenp0a0RrTFFQY3NKeTZfeUdQQWpxWkVGNDg3U191T1NUcmdxQzIxaFc2RjFHc3pVWnd6TVk4Nk1VYmR1RW00R2N0RkhRMldxM1JPYjYwd1BKY3VzdzcwQzY5RDhEQ3hmYzRIZURnYVlMbTFITXBNUG5pN05Ba1VOQ2RHOGp6LUxZXzZkT0NGNFZfUlpMRDFxcjl1WkxmQmhvRDdMMUhOTjNwdGhyeXB4SlNqVzdJdzZ0U0xSdXNEOUhfYTJDVWFteThFdl9LLU96WE44a2VzSXgwNTBGajAyVXVLd0dMakw0QjF0em9xUElxeU55NXhWNjJQMVVnSzRhdE9MblNxTTQyTDc1cTZ5U0RXY2pFT1E5eU01SG5jVE5iSnZfNGZkcEpDUmNUNXJjQjR5ZGJ5OER3NkR5Y2NKTGVfMkUzRnIyZHNQRUlFeDdZLTRNVW91U1Bmb1UydXpkQjhYSFBLcnZtaDUxbExYZV92Y3lYYml0dzVFZFJyVU9oeVVRTTN0RmUyT0djdF9lUGZDMnZ2d2NTZTJ1N3d6WE5xdjNGUFowYzl6SS10emg0N3F1YVRYSklsWlRydGZEdHNRcGkzRE9XXzJ6QkhlTGQ2VVFnd0VCZ1gzR3Vud2lFVUYyZmF5MWR5NjMzcmJhMVM0aHY3MGsyUWtBTWVlWkJiWWJhdDlDcEpISUEtcFlBZVlIUmo0US11S0t1NG5FM2JCRkxHWklJTlJuY2cwaS0tN3ZJSzlpYmt0THFsQ09iZ2FyMjZmb09mOXhEWVlhd2ZSUXduQ3FubVJWTHpOZUxROTNpOTFWaVdzdlhXZmpsN05ndDZOc2VZcFdwaHJCelJwSW9DWWZNemRtVHU2VGN6UXlFVTRnZ3NaRTEyTktDbUQ4dS1nQ1FlNnNNTldaS0pkR1Vfa1FkLXJmREQzQzlTTFduVGVHR3lBNlBITmdXeWRieXlVRlR5ejZscm13bTA2eko1QWpRREdGMkZhbkZkSHZpVEstS25rNGF0QzQ3RDRoVElLS3d2eUNjc0JCODFNTXlQYkhfaUU4WjZGYzQtLVptZTgySFI0MkpLMUNVUVpDQndKdHQyRm1MaDEwVWxzd3ZjTGg2bVRSbU1yQTczeDRuUzQ3RUpFQ1Y1Q0RLM0J4VXdxQ0lrbW9aNVVKV3VDTHpIX1NQWkpyTDdBYm9YTkk2Rm9SS21Ta05JTFF0RGpaa0pBS05tQTRMMWtSM29YY3J2cWJtSmk4aXl6MGRfdGFIeEtJQVBpQXN0cVFsRzBJREtzZERhTkZWSC1Dajd6ODgzd0VQaW9QX2xwMzF5eXdJa2xTQlVvSDRveV8xOWtpZ0ZfelAyU29lVnBZQllZNmdtMVNZU0FnYV94ZWtsWkxQcXUzYjJ2cjIxeG5jU3dSVXFCTHRlMjNVTHlQcmU4dXJDMFlCTEF4am03cjFtaDY1WVJ3U0J5OFRYMWt6M1ZkTllLbUMwVTM3UmhzVEtZUk9seGdtb3N0aUNvalhpamM=)
    GOOGLE_SERVICE_ANDROID: Encrypted(Z0FBQUFBQmd2MkVpY1o3bVdSRXNZWGE0LTJ1MXdNMEMwZ1Axb09VVTkyLUhYZGtiQ2x4ZWNYajFjQWxWbERhemJCQjRlZGxKMWtpZ0lkR1VGZ0lsSVRkZTdnc0NhdHhZa3RRaVlGWDBGUnFPNTduU0k2dHlzRXFXWUpVTHUzMkZoNlU0TDNLeERRMVhsaDlMRUhIbEx5elVnODY2TW1Vd1NTaXNmN3FjdjlqMjdxZlBqNVNJNmZnamh2cVRjei1DWndwTFFNWTBMSkI4Y0toWEdYNHI2QWw5cjFtTl9PSzQzRklQLTNiUDdQck0tYTBLTFNmVkhlOXhLMkY2dDh0M1RPSDduRmhlZFZTOWZtMDk2ZW95LVlZVHIyRGJNVHVxem5zb2haYXRGeXEwT2UwZG9FTmkwbjAxcWJoQlVYRVhvWXdyMkxXMmF2QVladllzQXhMUjVQUW9Oc3FZdjhLd0MxOWlkRlgybERBQXRlNWRLMk50VVB3dm5MUXl3TV92ZWNiVWpaeTRIajRJak9qTkxyLUpmTzF0Y3ZPekhtZDlsN1ZDNGh3YzQ5LTl5aWx4enFoZE9uR1pDWVBPQTNuc0xCcDJsanFxWnlqejk5OHpuWnVSX2RRVXl3Vldvd1ZOaXdpZUZrTDQyTnAzZVc4d3JPcDVsX1QzZnVOaTBDYUt1OTJWbFhOSW1LSWNUZF91TGw3M3YyalMtVlRkYXZTQVdpeGpQVXcyS1JOR2pHRnd0bFBHdEFQSEY1ek1EeDQ4ekVJeEJ1R3o4cDFNOFh3V2dUSXFoVmxOaTF3S0xubGcxQVFVQURoVGhtbmczcW9Oa0NIWEVIVnR2M3V6MVBSRTFxbEN0d0ZQcnMtTGxvcllaZlNlUE9Ld0tTdmdQVi1ycVNueGF5MTlpVmowZmpNOVRHT0x0eC1YczhyME5SdHkxcjhMUkxOeVQ3elR6ZVBKaHNnUWtBRzR4NDlldmpHZU5rbE1VeGhKRzdlckppRFZmTGdOSk1fU1A3b1NLREt5b3JKakU5MHcwUWF1WURkckU4YW5wOXI1NGFOVTk1VUw2ZjhqQ2RKVEFJVmRwNlBsWlpjaF9ZZmlDWnJMdk02d3h6djJSYkNOdFVHN1pNSUxnbUVIZmVhREt0bERxZzFPWTRwcUlwMDR1LWg3YS0tUll2MHE0QW8xZFk0T2E2MjNiV2tXandsTFh6N180UDZnLTJGUW1CbU1FZFY2WlphUjM1U0Z6UmQtOHhTbVQ4QWprbzFWdEtOWlNwTGVjYzUwQm5vMC1pMmFPYS04VTU4YnFQYnA2TVdhdGFQWWtLaW5jeEsyaVhkTV9rWnZDSC1mZzhrS3ZEc1g3Z3Vmd3VzWG5sMXQ4eVd5NndsZGtjaGc4VktBcG8zTzhXTHVSWUM1SDZQaGVPVEJ6cmJtUFFWSS1uX2Vock8yZENWRkk1LTNqYlVvUTNTeXVERDlTQTdEOTBOM0NPSXVZelVpS0lYUkk5TDR3b0JTblQzOTZRZ2JJZWVCOEVPenRhSEJvZl9NdG5ubUZFZnRCRENoQmd0ZVh2TEFWSTBWbzVWdHNwNkQydkZkQlRReEhsTU83cXZHbHFvWXhlc0RhRm9FTHBYSHpVOEkyLVpaNFRCazVkeU55aElnUDFCMVJFU3FhdFdvV0duT3JldmRWQk1jbl9WZnRXQ3FvWW8wbFV6OHoySmtPNzB6MXZ1OEhuU1pBVkRHX2RCdGRNVmxfNDJDZmI4VkxwSjRrMm9VM2NLTDB1ajdXTWpNM05nWDlCbkpOY0VRZ04yT1lKcWxRRUp0V0kwclNYWFBiX1U5Q25nR0VRWHo5Q1VmZVV0OGM3T1dpRkdVT1I4eVBtNmhLMzEwbFQ4Z2NKaEw3SXh1VUlZdGg4N1JNZjNiV3FuOXVROHd0SEM1SjUyWU9uMDBlUUk0WTFUYXJqeVZpUFhYc2VNMmVYSXo5aWd5N1RLWGV5d0N4cnhvcjVoSVBycWtJQ1BOQlBUVlNoU3lvRkdMVWo3SmlmenQ4UGlpcVJ0MU1NOVJrV0JNS1ZOQ1NYZENZdTB6WDUwUjlIU2o3M1VqYXdoMzVlZ0pDUzBISFEzbTV6b3V5X0ROMExJNEUxWDZiUVp3TGoyQUdZMHpRbVZVa280MjU0TV9Fd0J6MlhlNFRPSU1YSTNsQTVZd1BjYW5ycjEtR2RfNVpZWlB6NzRzcFlaRG93M3hSWFBabU41em1TXzEzWlRmMTRPOUM1cFpGM1NMd25ib2F4Q3hMeEdObHJ1SDJyLWZMdXpYeFllaEtSV2UxYVZSNTNzNUlGVHFJS01wR0J4YURmV1VyTmlXdllhclNmckJxZVNlWU52bXc4TlQ3TEp6ZmZEYnozZ24wam44RkNKLWtlcHVVYXBYVGE4RGhrMjBhRmhEdGVneWNTQy1kWjBJNlRGXzBQMXpsb21ZdER1SjBhZDJKSlRpQlBpM2lxTi1oSTFWSkp3MDZwenpSNzdMYlgzeDNKMHBRQnN1aDctSTZKN2JwdXUwU2p2RWMzNmcwOUtqeTVKRzRiMFVLWE8zZm85NEhXVmcwX1pXMG5WYWFpdUFYalJ5aHR4NUF6eG1WV0pDVmFFd1BlbWY3N2h0OWVhbFUyaGs3VjQzSTB5NUdxS0hGQnJYVkZQaVB5WHdqTWFvRGNvbzVNeG5RaE8xS1pLUnN1c1lXd0FFcFRRYkZnMkQtbWpSX3JDR1RMWTBFS05oLVQ0X0NyODBOS2g2S1l6cjljM1pja29kVS1iR2Z2S09xYjNaSWFUb1NhUEo3QkxHNm1CVDRGYWlEY3BQcXB1UUpmQzZxRzhtRTFIYlNtN2xKOXFOUHJhMlJ3aXUtNTRKZGVrRHNqcjd4bUVpdV9vYWZieVBWaFNBdm5sRXFOQ2RnN0cyQmVyYVJPbDNiSDRuVEdBeDBpcmNZMk9kVzhBTEF6QWhtWVFSakd2a052ekhFZXUzYmk3RUZ0YVVZZnhzOGFHd1dEY1JwREt6THVqZTJSaFNZaFhLcTB2Mk8xZFE5X3VzN0h6UnJ5RDF5ZFg4WW1WUHp5Tzh4ZU5YM21wT3lFWnVlb3d4OTI5UUxHU01WdHpaUkFXLV9uUUkwWnFETUlMdlNSX3ZQelBTUDM5WEgwND0=)

  versioning: &versioning
    flutter: stable
    xcode: latest
    cocoapods: default

  cache: &cache
    cache_paths:
      - $FLUTTER_ROOT/.pub-cache
      - $HOME/.gradle/caches
      - $HOME/Library/Caches/CocoaPods

  triggering: &triggering
    branch_patterns:
      - pattern: '*'
        include: false
        source: false
    cancel_previous_builds: false

  auto_develop_triggering: &auto_develop_triggering
    events:
        - push
    branch_patterns:
      - pattern: develop
        include: true
    cancel_previous_builds: false
    
  scripts: &scripts
    - name: Set up keychain
      script: keychain initialize

    - name: Fetch signing files
      script: app-store-connect fetch-signing-files $BUNDLE_ID --type IOS_APP_STORE --create

    - name: Use system default keychain
      script: keychain add-certificates

    - name: Set up code signing settings on Xcode project
      script: xcode-project use-profiles    

    - name: Add google-services.json
      script: echo $GOOGLE_SERVICE_ANDROID | base64 --decode > ./android/app/google-services.json

    - name: Add GoogleService-Info.plist
      script: echo $GOOGLE_SERVICE_IOS | base64 --decode > ./ios/Runner/GoogleService-Info.plist

    - name: Get packages
      script: flutter pub get

    - name: Generate autogenerated files
      script: flutter pub run build_runner build --delete-conflicting-outputs

    - name: Analyze
      script: flutter analyze

    - name: Run tests
      script: flutter test --update-goldens
    
    # - name: Build IOS with automatic versioning
    #   script: |
    #     flutter clean
    #     rm -f ios/Podfile.lock pubspec.lock
    #     rm -rf ios/Pods ios/Runner.xcworkspace
    #     flutter build ipa -t $MAIN_TARGET --release --build-name=1.0.1 \
    #     --build-number=$(($(app-store-connect get-latest-testflight-build-number "$APP_STORE_ID") + 1))  \
    #     --dart-define=MY_APP_ENV=prod \
    #     --export-options-plist=/Users/builder/export_options.plist
    
    - name: Build Android (APK)
      script: flutter build apk -t $MAIN_TARGET

  publishing: &publishing
    app_store_connect:             
      apple_id: $APPLE_ID    
      password: $APPLE_APP_SPECIFIC_PASSWORD

    email:
      recipients:
        - illia.s@smplt.net
        - vladimir.m@smplt.net
        - vovkamedvedev5@gmail.com
        - novichikhin.au@gmail.com
        - andrey.p@smplt.net
        - andrey.v@smplt.net
        - danil.s@smplt.net
        - denis.m@smplt.net
        - ruslan.s@smplt.net
        - ruslan.skyba.ser@gmail.com
      
      notify:
        success: true
        failure: false

    scripts:
      - name: Post-publish script
        script: echo 'Published Successfully!'

  artifacts: &artifacts
    - build/**/outputs/**/*.aab
    - build/**/outputs/**/*.apk
    - build/ios/ipa/*.ipa
    - /tmp/xcodebuild_logs/*.log
    - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.dSYM
    - flutter_drive.log

workflows:
  development-workflow:
    name: Development Workflow
    <<: *build_config

    environment:
      vars:
          MAIN_TARGET: "lib/main_development.dart"
          <<: *developer_credentials
          <<: *apple_signing
          <<: *new_app_trading_config
      
      <<: *versioning
    
    cache: *cache
    triggering: *triggering
    scripts: *scripts
    publishing: *publishing
    artifacts: *artifacts
  
  stage-workflow:
    name: Stage Workflow
    <<: *build_config

    environment:
      vars:
          MAIN_TARGET: "lib/main_stage.dart"
          <<: *developer_credentials
          <<: *apple_signing
          <<: *new_app_trading_config
      
      <<: *versioning
    
    cache: *cache
    triggering: *auto_develop_triggering
    scripts: *scripts
    publishing: *publishing
    artifacts: *artifacts

  production-workflow:
    name: Production Workflow
    <<: *build_config

    environment:
      vars:
          MAIN_TARGET: "lib/main_production.dart"
          <<: *developer_credentials
          <<: *apple_signing
          <<: *new_app_trading_config

      <<: *versioning
    
    cache: *cache
    triggering: *triggering
    scripts: *scripts
    publishing: *publishing
    artifacts: *artifacts
