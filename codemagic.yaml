workflows:
  development-workflow:
    name: Development Workflow
    instance_type: mac_mini
    max_build_duration: 60

    environment:
      vars:
          GOOGLE_SERVICE_ANDROID: Encrypted(Z0FBQUFBQmd2MkNHRzFrQjc5Q2puSTBuM3NySUpwWXdwQmMtQkNJRFpLdmVrZXluT0hVelRzSTdIV3RHaXFydWpOeVg2cUNpWGhMMHZMXzU2TktmLXctaF80YkEwZVZlXzUzN2Q5RDdsVFc1U2RKMXJKZDNENlQ4TU9reGMyQmh6UFZrRFRmX1kydXA1MmZFUzhJQnVqTlhSdXJyZ0RHS18zaG9wLW00VWF0WlhiQzAxemtTa1BRcldfd2ZkWlRVd1BVTXFWMmltUlN3UDNXYTJMSC1pYTJMVy1qYWJlOTB2NGE0dUQ3WHI0U1J3YXdSMTRFbVVxU3RzMFZoRTRUbG51bk96cm03SWFpRVJXVGJibll3cTVyWFR1TU9KZVZTbnpyRklPTkZZUFdpTnlBM1g4M0NmWUE1R2NHbmlzX3BtMEIyU3FNVnAzMDRKTThqR1o3bi0wc2Y1MjBuTndtTzhyWkVXdDJHRGlJZlBVUENab1lRMWZncW94b0d1LWpkSXJxSG1sU1NMYnNiMnhlYnBtVkRZc0tTS3J3dGgyQjhtZkNaUzljYmVxWGRWRVZ1X3gtakRPbVc1OTNGU3BJVUdEOHZRSXFHYjZDaTZwNVZ4VzExbmM1d1hZR0xfM3laT0V0ZF8tUF95MS11MERFdXRocUhzNzR4X0Z4Y2tGSk1aMlA1WnFQRENlU1lqbWRYQUFKZWN3MnNLclBWVWdOWlpISDFqTXNFQXhuY2JtVTVDeHAza3pqQ0NDaGNYbTFET2RmS05COEgtOUtZZXVLY1JYMEJiWVY4YXlXN2Y5V2dzZEswdVNjWVR1bVdhR2JFUGFwdnRfU3p0RmlqbC1WV2xSRExjMkZaVnJrMEtoRS1VOHEtZnBDVjVidjJ2ZkRjTnhPV1JJZXVYY1o1T0FUZGFESXdoRkVRRzc4b1RQelVhNDEzYjRnTHg5NG45bC1FZTdXMnAzdnZkT0NYZHhPV3Zwd1JrQW5vazQzd3BVWW45V2RSeGEtbFFTZXBuNGVQTDdPVG55UG80TXRQOExtVW1QY21BYmctU09MaWg0a1N5WlVudWVhSl9EYWRmVElOdXJmUlNXeDZnWTVBbmNkRXJhblp6TnNBajFiakdHY0JBWVVtTThqekdoNV9TanY0Y3BCcVBNSG9CdVN4UXFPRkFUQS1uVFk2SzlTd25IRURZTzUtVUdCV1NqRjliZUdLckZCb3Y1RkhtSVg0V2Y4S1NocGptNnhDX0hPbmtoay14andvLUo4WnhNVVpZSWpTX25ocEhNbVczczhJTExHbk5BZTYtNTlNSk9OVHg3SUQxOU5oMlVXNkpJWnZhRldqWjlWVTRsZm52QTNWSFhoY3A0QkVFem1mNGxtWkhKcmlkLXJDMGlkQUZ4RUFSVWtfdTkyMWJLZF9rR2lUSHFFRXl4LS1LUmJVTzFLSWJJVFhuN2RFOEhDWV83d0RYNkVBYmE5SGFnYnFmd0I0LU9UckVoNVpfdnR5YnZlUm1yVWIyVUttMDdhMTZ5em1YaUFpby1KbmlWRnpGS2ZiSkYyNThlTFZzWGs0XzdzMjdSMXFqRFp1VkV0eExydkNFWXgwWHVmWFFHMWJ6YXJXeldnc2VRdlpJWXpxSDFsaDlJT0wxaHJPbVZvX2l5Y3Y0cUtsaXBDMWRhSndFVUpJVEYzMWt1UVUzTHlQLW9adlBrQ1JjVEQ5eFdDQjZ1cmtvMFUyQkhsNXdYdWctb2RGakxoZHczSTRDSFRwS2hoemw1c0dWNGxVSk5ZaUxEelpVMVVINDAxNnFWLVJmXzFUcm5IaDNYVHo5QnZDTUR6aHNxd2plTzhSRTVkOTFnSk5TeVpielpSTm5XS3NiQk9kNnY4MjRtV2dKUl9aQWtSLUk5WnE3T2Z2Z2VkSnhuVDJJNzdtT1UxaXRubno3NExlM3k2UmFBZWtYYnAxY1F1N1VhTVk4NmxhSGxGc3ZfdTFqRjVfVi1sZVlRZVZ0VURNSy1BQUVwLXBsRjJSZDdOUGQzeGdRY0p5M1ozN1VZTDJDR1lucl8yXzNKZ2J3dWU4aE9QR1BQVGtydk0tVDNsQVNoR015RXVtQVZ2aWNXczYtMEhqVXFJNFdza0R4RGdfdVFNdDNaWjdXejBiaVUxdDQxOE1MNDdmOUVfREN3TUxlb3ZMbGJIYnpzRkhPbmpEclNjS2VZU1VKQzhRNHUzWU8yUzk0SkhMUEVaX0Fqb2c4R21qWFgtbGNGcWxzVTgzaG5vMTNQaTNUOGM3NmlCQS1FVDhwbVRVYjF5SUlDY3duaWFHZHNTU1VKVTQ0aWlfc01JaHlHbVg3dE5iQnRKRHlrZkxKMjJ5OExsNWk3VEd6YXR4R2J4Z2pLaz0=)
      flutter: stable
      xcode: latest
      cocoapods: default

    cache:
      cache_paths:
        - ~/.pub-cache

    triggering:
      branch_patterns:
        - pattern: 'master'
          include: true
          source: false
        - pattern: 'develop'
          include: true
          source: false
        # TODO Delete after configuring ci
        - pattern: '*'
          include: true
          source: true
      cancel_previous_builds: false

    scripts:
      - name: Add google-services.json
        script: echo $GOOGLE_SERVICE_ANDROID | base64 --decode > ./android/app/google-services.json

      - name: Get packages
        script: flutter pub get

      - name: Generate autogenerated files
        script: flutter pub run build_runner build --delete-conflicting-outputs

      - name: Analyze
        script: flutter analyze

      - name: Run tests
        script: flutter test --update-goldens

      - name: Build Android (APK)
        script: flutter build apk

    artifacts:
      - build/**/outputs/**/*.aab
      - build/**/outputs/**/*.apk
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - flutter_drive.log
    
    publishing:
      email:
        recipients:
          - elistark.tech@gmail.com
        notify:
          success: true
          failure: false
      
      scripts:
        - name: Post-publish script
          script: echo 'Published Succesfully!'